<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>S5 MagicImpute · RABBIT</title><meta name="title" content="S5 MagicImpute · RABBIT"/><meta property="og:title" content="S5 MagicImpute · RABBIT"/><meta property="twitter:title" content="S5 MagicImpute · RABBIT"/><meta name="description" content="Documentation for RABBIT."/><meta property="og:description" content="Documentation for RABBIT."/><meta property="twitter:description" content="Documentation for RABBIT."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">RABBIT</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox"/><label class="tocitem" for="menuitem-2"><span class="docs-label">Guide</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../run_rabbit/">Run RABBIT</a></li><li><input class="collapse-toggle" id="menuitem-2-2" type="checkbox"/><label class="tocitem" for="menuitem-2-2"><span class="docs-label">Prepare Inputs</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../prepare_input/prepare_genofile/">Prepare genofile</a></li><li><a class="tocitem" href="../../prepare_input/prepare_pedinfo_designcode/">Prepare pedinfo: designcode</a></li><li><a class="tocitem" href="../../prepare_input/prepare_pedinfo_pedfile/">Prepare pedinfo: pedfile</a></li><li><a class="tocitem" href="../../prepare_input/prepare_phenofile/">Prepare phenofile</a></li><li><a class="tocitem" href="../../prepare_input/prepare_convert/">Prepare by converting </a></li></ul></li><li><a class="tocitem" href="../../understand_output/">Understand outputs</a></li><li><a class="tocitem" href="../../key_options/">Key options</a></li><li><a class="tocitem" href="../../statistical_framework/">Statistical framework</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox" checked/><label class="tocitem" for="menuitem-3"><span class="docs-label">Pipeline</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../s0_pipeline_overview/">Overview</a></li><li><a class="tocitem" href="../s1_magicsimulate/">S1 MagicSimulate</a></li><li><a class="tocitem" href="../s2_magicfilter/">S2 MagicFilter</a></li><li><a class="tocitem" href="../s3_magiccall/">S3 MagicCall</a></li><li><a class="tocitem" href="../s4_magicmap/">S4 MagicMap</a></li><li class="is-active"><a class="tocitem" href>S5 MagicImpute</a></li><li><a class="tocitem" href="../s6_magicreconstruct/">S6 MagicReconstruct</a></li><li><a class="tocitem" href="../s7_magicscan/">S7 MagicScan</a></li></ul></li><li><a class="tocitem" href="../../rabbit_cli/">CLI</a></li><li><a class="tocitem" href="../../rabbit_api/">API</a></li><li><a class="tocitem" href="../../ref/">Citations</a></li></ul><div class="docs-version-selector field has-addons visible"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"><option value="#" selected="selected">v1.0.0</option></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Pipeline</a></li><li class="is-active"><a href>S5 MagicImpute</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>S5 MagicImpute</a></li></ul></nav><div class="docs-right"><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="S5-MagicImpute"><a class="docs-heading-anchor" href="#S5-MagicImpute">S5 MagicImpute</a><a id="S5-MagicImpute-1"></a><a class="docs-heading-anchor-permalink" href="#S5-MagicImpute" title="Permalink"></a></h1><h3 id="MagicImpute"><a class="docs-heading-anchor" href="#MagicImpute">MagicImpute</a><a id="MagicImpute-1"></a><a class="docs-heading-anchor-permalink" href="#MagicImpute" title="Permalink"></a></h3><div class="admonition is-info"><header class="admonition-header">magicmask_impute</header><div class="admonition-body"><ul><li><code>magicmask_impute</code> combines <code>magicmask</code>, <code>magicimpute</code>, and <code>imputeaccuracy</code>.</li><li>By default, <code>magicmask</code> masks 10% genotypes (<code>foundermask=0.1</code>,<code>offspringmask=0.1</code>). For sequence data, mask only genotypes with read depth &gt;= minread (<code>minread=10</code>).</li><li>Use <code>magicimpute</code> without masking genotypes. </li></ul></div></div><p>The <code>magicimpute</code> first imputes founders and then imputes offspring. During the iterative founder imputation, it simultaneously performs the following:</p><ul><li>Impute founder genotypes.</li><li>Delete markers that do not fit in. By default, <code>isdelmarker = true</code>.</li><li>Correct founder genotypes. By default, <code>iscorrectfounder = true</code> if <code>model=&quot;depmodel&quot;</code> or offspring do not have genotypes in AD format`.</li><li>Infer marker-specific error rates. By default, <code>isinfererror = true</code> if model is not &quot;depmodel&quot; or <code>isspacemarker = true</code>.</li><li>Refine local marker ordering. By default, <code>isordermarker = true</code> if <code>mapfile</code> is not nothing.</li><li>Refine inter-marker distances. By default, <code>isspacemarker = true</code> if <code>mapfile</code> is not nothing or <code>isordermarker = true</code> or <code>isphysmap=true</code>.</li></ul><p>After founder imputation, <code>magicimpute</code> imputes offspring. </p><ul><li>If <code>phasealg=forwardbackward</code>, for each offspring at each marker, the posterior diplotype probabilities (in format GP) corresponding to the phased genotypes <code>0|0</code>, <code>0|1</code>, <code>1|0</code> and <code>1|1</code> are caculated according to the forward backward algorithm, and the called phased genotypes (in format GT) are given by those with the largest posterior diplotype probabilities if they are greater than <code>threshimpute</code>. </li><li>If <code>phaselag=viterbi</code>(default), the posterior diplotype probabilities (GP) are set as those of <code>phasealg=forwardbackward</code>, and the called phased genotypes (GT) are calculated according to the Viterbi algorithm. </li><li>If <code>phaselag=unphase</code>, the posterior genotype probabilities (GP) corresponding to the unphased genotypes <code>0/0</code>, <code>0/1</code>, and <code>1/1</code> are caculated by tranforming the posterior diplotype probabilities of <code>phasealg=forwardbackward</code>, and the called unphased genotypes are given by those with the largest posterior genotype probabilities if they are greater than <code>threshimpute</code>. </li></ul><pre><code class="language-julia hljs"># code for Julia
using MagicImpute
cd(@__DIR__)
genofile = outstem*&quot;_magicfilter_geno.vcf.gz&quot;
pedfile = outstem*&quot;_magicfilter_ped.csv&quot;
magicmask_impute(genofile,pedfile;
    mapfile = outstem*&quot;_magicmap_construct_map.csv.gz&quot;,          
    outstem     
)</code></pre><pre><code class="language-bash hljs"># code for Linux shell. 
# For Window CMD, replace multiline key \ by  ^, and replace comment-key # by ::
julia rabbit_magicmask_impute.jl -g example_magicfilter_geno.vcf.gz \
    -p example_magicfilter_ped.csv \
    --mapfile example_magicmap_construct_map.csv.gz \
    --nworker 5 \
    -o example</code></pre><h3 id="Output-files"><a class="docs-heading-anchor" href="#Output-files">Output files</a><a id="Output-files-1"></a><a class="docs-heading-anchor-permalink" href="#Output-files" title="Permalink"></a></h3><table><tr><th style="text-align: left">outfile</th><th style="text-align: left">Description</th></tr><tr><td style="text-align: left">outstem*&quot;_magicimpute.log&quot;</td><td style="text-align: left">log file</td></tr><tr><td style="text-align: left">outstem*&quot;_magicmask_geno.vcf.gz&quot;</td><td style="text-align: left">genofile with some genotypes being masked</td></tr><tr><td style="text-align: left">outstem*&quot;_magicmask_reversed.vcf.gz&quot;</td><td style="text-align: left">ground-truth genofile with calculated accuracy</td></tr><tr><td style="text-align: left">outstem*&quot;_magicimpute_geno.vcf.gz&quot;</td><td style="text-align: left">result genofile for downstream analysis</td></tr><tr><td style="text-align: left">outstem*&quot;_magicimpute_founder.vcf.gz&quot;</td><td style="text-align: left">intermediate genofile after founder imputation</td></tr><tr><td style="text-align: left">outstem*&quot;_magicimpute_geno.vcf.gz&quot;</td><td style="text-align: left">result genofile for downstream analysis</td></tr><tr><td style="text-align: left">outstem*&quot;_magicimpute_map.csv&quot;</td><td style="text-align: left">result mapfile</td></tr><tr><td style="text-align: left">outstem*&quot;_magicimpute_inferred_error.png&quot;</td><td style="text-align: left">statistical plots of inferred error rates</td></tr><tr><td style="text-align: left">outstem*&quot;_magicimpute_compare_inputmap.png&quot;</td><td style="text-align: left">compare refined mapfile with keyword mapfile (if not nothing)</td></tr><tr><td style="text-align: left">outstem*&quot;_magicimpute_delete.csv&quot;</td><td style="text-align: left">collection of deleted markers</td></tr><tr><td style="text-align: left">outstem*&quot;_magicimpute_founderacc.csv&quot;</td><td style="text-align: left">imputation accuracy for each founder</td></tr><tr><td style="text-align: left">outstem*&quot;_magicimpute_offspringacc.csv&quot;</td><td style="text-align: left">imputation accuracy for each subpopulation</td></tr></table><h3 id="Output:-imputation-accuracy"><a class="docs-heading-anchor" href="#Output:-imputation-accuracy">Output: imputation accuracy</a><a id="Output:-imputation-accuracy-1"></a><a class="docs-heading-anchor-permalink" href="#Output:-imputation-accuracy" title="Permalink"></a></h3><p><code>outstem*&quot;_magicimpute_founderacc.csv&quot;</code> gives imputation accuracies for each founder, and <code>outstem*&quot;_magicimpute_offspringacc.csv&quot;</code> gives imputation accuracies for subpopulation, assuming that masked genotypes in <code>outstem*&quot;_magicmask_reversed.vcf.gz</code> are ground truth. These output files ( + <code>outstem*&quot;_magicmask_geno.vcf.gz&quot;</code>) do not exist for <code>magicimpute</code>. </p><pre><code class="language-julia hljs">using CSV, DataFrames
outstem = &quot;example&quot;
CSV.read(outstem*&quot;_magicimpute_founderacc.csv&quot;,DataFrame; comment=&quot;##&quot;)</code></pre><div><div style = "float: left;"><span>4×7 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">founder</th><th style = "text-align: left;">noffspring</th><th style = "text-align: left;">nmarker</th><th style = "text-align: left;">miss_afterimpute</th><th style = "text-align: left;">ntrue</th><th style = "text-align: left;">nonimpute</th><th style = "text-align: left;">correctimpute</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "InlineStrings.String3" style = "text-align: left;">String3</th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: left;">P1</td><td style = "text-align: right;">200</td><td style = "text-align: right;">297</td><td style = "text-align: right;">0.0</td><td style = "text-align: right;">27</td><td style = "text-align: right;">0.0</td><td style = "text-align: right;">0.925926</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: left;">P2</td><td style = "text-align: right;">200</td><td style = "text-align: right;">297</td><td style = "text-align: right;">0.0</td><td style = "text-align: right;">30</td><td style = "text-align: right;">0.0</td><td style = "text-align: right;">0.933333</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">3</td><td style = "text-align: left;">P3</td><td style = "text-align: right;">200</td><td style = "text-align: right;">297</td><td style = "text-align: right;">0.0</td><td style = "text-align: right;">20</td><td style = "text-align: right;">0.0</td><td style = "text-align: right;">0.8</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">4</td><td style = "text-align: left;">P4</td><td style = "text-align: right;">100</td><td style = "text-align: right;">297</td><td style = "text-align: right;">0.0</td><td style = "text-align: right;">21</td><td style = "text-align: right;">0.0</td><td style = "text-align: right;">0.857143</td></tr></tbody></table></div><pre><code class="language-julia hljs">CSV.read(outstem*&quot;_magicimpute_offspringacc.csv&quot;,DataFrame; comment=&quot;##&quot;)</code></pre><div><div style = "float: left;"><span>3×7 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">subpop</th><th style = "text-align: left;">subpopsize</th><th style = "text-align: left;">nmarker</th><th style = "text-align: left;">miss_afterimpute</th><th style = "text-align: left;">ntrue</th><th style = "text-align: left;">nonimpute</th><th style = "text-align: left;">correctimpute</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "InlineStrings.String7" style = "text-align: left;">String7</th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: left;">pop1</td><td style = "text-align: right;">100</td><td style = "text-align: right;">297</td><td style = "text-align: right;">0.00828283</td><td style = "text-align: right;">608</td><td style = "text-align: right;">0.0444079</td><td style = "text-align: right;">0.951807</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: left;">pop2</td><td style = "text-align: right;">100</td><td style = "text-align: right;">297</td><td style = "text-align: right;">0.0423569</td><td style = "text-align: right;">697</td><td style = "text-align: right;">0.131994</td><td style = "text-align: right;">0.859504</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">3</td><td style = "text-align: left;">pop3</td><td style = "text-align: right;">100</td><td style = "text-align: right;">297</td><td style = "text-align: right;">0.0435354</td><td style = "text-align: right;">1012</td><td style = "text-align: right;">0.0899209</td><td style = "text-align: right;">0.915309</td></tr></tbody></table></div><h3 id="Output:-map-refinement"><a class="docs-heading-anchor" href="#Output:-map-refinement">Output: map refinement</a><a id="Output:-map-refinement-1"></a><a class="docs-heading-anchor-permalink" href="#Output:-map-refinement" title="Permalink"></a></h3><p><code>outstem*&quot;_magicimpute_map.csv&quot;</code> is the refined mapfile after refining local marker ordering and/or inter marker distance. <code>outstem*&quot;_magicimpute_compare_inputmap.png&quot;</code> compare the refined mapfile with the map of input genofile and the map of keyword mapfile (if no nothing). These output files do not exist if input map is not changed. </p><p><img src="../example_magicimpute_compare_inputmap.png" alt/></p><h3 id="Output:-genotyping-error"><a class="docs-heading-anchor" href="#Output:-genotyping-error">Output: genotyping error</a><a id="Output:-genotyping-error-1"></a><a class="docs-heading-anchor-permalink" href="#Output:-genotyping-error" title="Permalink"></a></h3><p><code>outstem*&quot;_magicimpute_inferred_error.png&quot;</code> gives the statical plots of inferred marker specific error rates. This output does not exist if <code>isinfererror = false</code>. </p><p><img src="../example_magicimpute_inferred_error.png" alt/></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../s4_magicmap/">« S4 MagicMap</a><a class="docs-footer-nextpage" href="../s6_magicreconstruct/">S6 MagicReconstruct »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.0 on <span class="colophon-date" title="Tuesday 7 January 2025 16:05">Tuesday 7 January 2025</span>. Using Julia version 1.11.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
